{% extends 'OrgabatGameBundle::base_listejeux.html.twig' %}
{% block body %}
    <div class="row">
      <div class="col-sm-9">
          <h1>{{ category.name }}</h1>
      </div>
      <div class="col-sm-3">
          <div class="panel panel-default">
              <div class="panel-body">
                  <p>Résumé :</p>
                  <div class="progress health">
                      <div class="progress-bar progress-bar-success" style="width:
                        {{ (stats['user']['healthNote'] / stats['global']['healthNote'])*100 }}%"></div>
                      <span class="stat">{{ stats['user']['healthNote'] }} / {{ stats['global']['healthNote'] }}</span>
                  </div>
                  <div class="progress organization">
                      <div class="progress-bar progress-bar-info" style="width:
                        {{ (stats['user']['organizationNote'] / stats['global']['organizationNote'])*100 }}%"></div>
                      <span class="stat">{{ stats['user']['organizationNote'] }} / {{ stats['global']['organizationNote'] }}</span>
                  </div>
                  <div class="progress notoriety">
                      <div class="progress-bar progress-bar-warning" style="width:
                        {{ (stats['user']['businessNotorietyNote'] / stats['global']['businessNotorietyNote'])*100 }}%"></div>
                      <span class="stat">{{ stats['user']['businessNotorietyNote'] }} / {{ stats['global']['businessNotorietyNote'] }}</span>
                  </div>
              </div>
          </div>
      </div>
    </div>
    <div class="row modules is-flex">
      {% for exercise in exercises %}
          {% set totalDoneNote = null %}
          {% set totalExerciseNote = exercise.healthMaxNote + exercise.organizationMaxNote + exercise.businessNotorietyMaxNote %}
          {% set minTotalDoneNote = totalExerciseNote / 1.4 %}

          {% if dones[exercise.id] is defined %}
              {% set totalDoneNote = dones[exercise.id].healthNote + dones[exercise.id].organizationNote + dones[exercise.id].businessNotorietyNote %}
          {% endif %}

          <div class="col-sm-4 game noselect {{ totalDoneNote >= minTotalDoneNote ? 'disabled' : '' }}" data-game-id="{{ exercise.id }}">
            <div class="content">
              <div class="panel-heading">
                  <h2 id="game_label">{{ exercise.name }}</h2>
              </div>
              <div class="panel-body">
                  <div class="infos">
                    <h4>
                      {% if totalDoneNote != null %}
                        {% if totalDoneNote >= minTotalDoneNote %}
                            <span>Jeu terminé</span>
                        {% else %}
                            <div>Meilleur score: {{ totalDoneNote }} / {{ totalExerciseNote }}</div>
                            <h5 class="requiredScore">Score minimum requis: {{ minTotalDoneNote|round(0, 'ceil') }} / {{ totalExerciseNote }}</h5>
                        {% endif %}
                      {% else %}
                          <span>Essaie-le !</span>
                      {% endif %}
                    </h4>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                  </div>
                  <div class="progresses">
                    {% if dones[exercise.id] is defined %}
                        <div class="tries">Tentatives: {{ tries[exercise.id] }}</div>
                    {% endif %}
                    {% if dones[exercise.id] is defined %}
                      <div class="progress health">
                          <div class="progress-bar progress-bar-success" style="width:
                            {{ (dones[exercise.id].healthNote / exercise.healthMaxNote)*100 }}%"></div>
                          <span class="stat">{{ dones[exercise.id].healthNote }} / {{ exercise.healthMaxNote }}</span>
                      </div>
                      <div class="progress organization">
                          <div class="progress-bar progress-bar-info" style="width:
                            {{ (dones[exercise.id].organizationNote / exercise.organizationMaxNote)*100 }}%"></div>
                          <span class="stat">{{ dones[exercise.id].organizationNote }} / {{ exercise.organizationMaxNote }}</span>
                      </div>
                      <div class="progress notoriety">
                          <div class="progress-bar progress-bar-warning" style="width:
                            {{ (dones[exercise.id].businessNotorietyNote / exercise.businessNotorietyMaxNote)*100 }}%"></div>
                          <span class="stat">{{ dones[exercise.id].businessNotorietyNote }} / {{ exercise.businessNotorietyMaxNote }}</span>
                      </div>
                    {% else %}
                      <div class="progress health">
                          <div class="progress-bar progress-bar-success" style="width:
                            {{ (0 / exercise.healthMaxNote)*100 }}%"></div>
                          <span class="stat">{{ 0 }} / {{ exercise.healthMaxNote }}</span>
                      </div>
                      <div class="progress organization">
                          <div class="progress-bar progress-bar-info" style="width:
                            {{ (0 / exercise.organizationMaxNote)*100 }}%"></div>
                          <span class="stat">{{ 0 }} / {{ exercise.organizationMaxNote }}</span>
                      </div>
                      <div class="progress notoriety">
                          <div class="progress-bar progress-bar-warning" style="width:
                            {{ (0 / exercise.businessNotorietyMaxNote)*100 }}%"></div>
                          <span class="stat">{{ 0 }} / {{ exercise.businessNotorietyMaxNote }}</span>
                      </div>
                    {% endif %}
                  </div>
              </div>
            </div>
          </div>
      {% endfor %}
    </div>

    <a href="{{ path('default_category') }}" class="col-sm-12 btn btn-success" role="button" id="return">Retourner aux modules</a>

{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/exercices.js') }}"></script>
{% endblock %}
